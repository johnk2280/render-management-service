# render-management-service

Реализация прототипа рендер фермы. Прототип представляет из себя клиент-серверное приложение предназначенное для отслеживания статуса своих задач на рендер ферме.
 
1. Клиент.  Консольное приложение со следующими возможностями:

    ◦ регистрация пользователя

    ◦ создание новой задачи

    ◦ отображение списка созданных задач (id, status)

    ◦ отображение истории смены статусов задачи

2. Сервер. Принимает от клиента запросы и обрабатывает их.

    ◦ Регистрация пользователя с занесением его в базу данных.

    ◦ Создание новой задачи для конкретного пользователя с занесением ее в базу данных.

    ◦ Обработка запроса списка текущих задач.

**Стек: Python 3.8, Django REST Framework, PostgreSQL, Celery, Redis.**

### Инструкция по установке локально.

1. Склонируйте репозиторий на локальную машину.
2. Настройте виртуальное окружение и обновите pip.
3. Установите зависимости командой:

          $ pip3 install -r requirements.txt
          
                   
4. Создайте базу данных:


           $ sudo -u postgres psq

           postgres=# CREATE DATABASE <db_name> OWNER <owner_name>;


5. В директории основного приложения создайте файл **.env** и заполните на основе шаблона **.env.template**
6. Перейдите в директорию проекта и выполните миграции командой:
            
           $ python manage.py migrate
           
7. Если миграций не случилось и вылетело исключение, необходимо удалить файлы миграций и создайте и выполните миграции заново:

           $ python manage.py makemigrations

           $ python manage.py migrate

8. Запустите проект:

           $ python manage.py runserver
           

### Запуск клиентского приложения и работа с API.

9. Прежде чем запустить клиентское приложение, необходимо запустить Redis в docker-контейнере командой:


            $ docker run -d -p 6379:6379 redis
            
10. После того, как контейнер с Redis запустится, необходимо запустить Celery командой:

            $ celery -A renderservice worker --loglevel=INFO
            
            
11. Далее можно переходить к работе с клиентским приложением. 
Клиентское приложение является приложением с интерфейсом командной строки (CLI). Запускающий файл приложения **clien_app.py** находится в директории **client**.

    Приложение реализует регистрацию нового пользователя, получения токена зарегистрированного пользователя, получения списка задач пользователя и получение истории смены статусов конкретной задачи зарегистрированного пользователя.

    Порядок действий:

        1. Для предоставления возможности получения данных, необходимо
        зарегистрироваться. Если вы являетесь зарегистрированным пользователем,
        то можно перейти к следующему шагу.

        Итак, что бы зарегистрироваться, необходимо направить POST запрос
        на адрес http://hostname/api/v1/registration с указанием имени
        пользователя и пароля. Примеры запроса:

            $ python client_app.py post http://hostname/api/v1/registration --u=username --p=password

        Если регистрация прошла успешно, то в ответ получите json-объект
        с указанием имени пользователя:

            {

                "username": "gomerSimpson"

            }

        В противном случае сообщение с указанием ошибки.

        2. Для получения токена, необходимо отправить POST запрос на
        адрес  http://hostname/api-token-auth/ с обязательным указанием
        имени пользователя и пароля. Пример запроса:

            $ python client_app.py post http://localhost/api-token-auth/ --u=gomerSimpson --p=password

        В случае успешного выполнения запроса придет ответ с указанием токена:

            {

                "token": "bb79f1772ac1b86d57812d904ed89bc16cdc2991"

            }

        В противном случае сообщение с указанием ошибки.

        3. Для получения списка задач пользователя, необходимо отправить
        GET запрос на адрес http://hostname/api/v1/tasks/ с обязательным
        указанием токена. Пример запроса:

            $ python client_app.py get http://localhost/api/v1/tasks/ --t=e500ac59777571c051d405dbee9a31e7a07d2c2c

        4. Для создания новой задачи, необходимо отправить POST запрос
        на адрес http://hostname/api/v1/task_create/ с обязательным
        указанием токена. Пример запроса:

            $ python client_app.py post http://localhost/api/v1/task_create/ --t=e500ac59777571c051d405dbee9a31e7a07d2c2c

        5. Для получения истории смены статусов задачи, необходимо отправить
        GET запрос на адрес http://hostname/api/v1/task_history/<task_id:int>
        с обязательным указанием токена. Пример запроса:

            $ python client_app.py get http://localhost/api/v1/task_history/29 --t=e500ac59777571c051d405dbee9a31e7a07d2c2c

